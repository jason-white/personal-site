{{/* Variables */}}

{{- $respSizes := slice "375" "640" "960" "1280" "1600" "1920" -}}
{{- $src := .Params.image -}}
{{- $alt := .Params.alt -}}
{{- $cap := .Params.caption -}}
{{- $dataSzes := "(min-width: 1024px) 50vw, 100vw" -}}

{{- if .Page.Resources.GetMatch $src -}}
  {{ with .Page.Resources.GetMatch $src }}
    {{- $imgRsc := . -}}
    {{- $actualImg := $imgRsc.Process "resize 640x jpg MitchellNetravali" -}}
    <figure class="post__feature">
      <picture>
        <source type="image/webp" srcset="
          {{- with $respSizes -}}
            {{- range $i, $e := . -}}
              {{- if ge $imgRsc.Width . -}}
                {{- if $i }}, {{ end -}}
                {{- ($imgRsc.Process (print "resize " . "x webp photo MitchellNetravali")).RelPermalink }} {{ . }}w
              {{- end -}}
            {{- end -}}
          {{- end -}}" sizes="{{ $dataSzes }}" />
        <source type="image/jpeg" srcset="
          {{- with $respSizes -}}
            {{- range $i, $e := . -}}
              {{- if ge $imgRsc.Width . -}}
                {{- if $i }}, {{ end -}}
                {{- ($imgRsc.Process (print "resize " . "x jpg MitchellNetravali")).RelPermalink }} {{ . }}w
              {{- end -}}
            {{- end -}}
          {{- end -}}" sizes="{{ $dataSzes }}" />
        <img src="{{ $actualImg.RelPermalink }}" width="{{ $imgRsc.Width }}" height="{{ $imgRsc.Height }}" alt="{{ $alt }}" />
      </picture>
      {{- if $cap -}}
        <figcaption><p>{{ $cap }}</p></figcaption>
      {{- end }}
    </figure>
  {{- end -}}
{{- else -}}
  <p><em>Image unavailable.</em></p>
{{- end -}}
